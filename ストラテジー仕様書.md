# ストラテジー仕様書

## 1. プロジェクト概要

### 目的
このストラテジーの主な目的は、**リスクを抑えながら大きなリターンを得る**こと。特にドローダウン（資産の大幅な減少）を最小限に抑えることで、安定したメンタルを維持しながら運用を続けることを重視しています。

### 対象銘柄
ユニバースとして、**日本株の中でも大型の銘柄群であるTOPIX500採用銘柄**を選定しています。

### 日本株を取引対象に選んだ理由
1. **データ取得の容易性**  
   - 個別銘柄の値動きや財務情報に至るまで、データを取得しやすい。
2. **特徴量設計のしやすさ**  
   - 日本市場が米国市場のクローズ後に開場するため、**米株・為替・債券・商品**などの情報を特徴量として活用しやすい。

### 大型株（TOPIX500）を取引対象に選んだ理由
1. **信用売りが可能**  
   - TOPIX500採用銘柄の多くが信用取引に対応しており、柔軟な売買戦略を組むことができる。
2. **流動性が高い**  
   - 出来高が多く、注文がスムーズに成立しやすいため、運用効率が高い。
3. **値動きが予測しやすい**  
   - 投機的な動きが少なく、比較的予測可能な値動きが期待できる。
4. **マーケットインパクトを抑えやすい**  
   - 運用資金が増えた場合でも、市場に与える影響を最小限に抑えた取引が可能。

### 業種分類
ユニバースであるTOPIX500採用銘柄を、独自に定義した**48業種**に分類し、業種単位で売買を行います。

#### 業種分類の利点
1. **分散効果**  
   - 業種ごとの取引でリスクを分散。
2. **柔軟性**  
   - 業種ごとの市場状況や特徴に応じたトレード戦略を適用可能。
3. **データ分析の効率化**  
   - 業種単位でのデータ集計と特徴量作成が可能。
4. **リターン予測のしやすさ**  
   - 業種ごとに特異なリターンを示すことが知られており、**業種間で予測結果の差異を出しやすい**。
   - **商社セクターと原油価格**のように、特定のセクターと指標のリターンとの相関が強い場合があり、予測精度を向上させやすい。
   - また、モデルの解釈性を担保しやすい。

#### 独自の業種再定義を行う理由
- **似通ったファクターの影響を受ける銘柄同士をグループ化**することで、予測精度を向上させるため。
  - 既存の**17業種**や**33業種**では、業種内の銘柄が必ずしも似通った値動きをしているわけではありません。
  - そのため、**似通った値動きをする銘柄をグループ化**し、それを基にインデックスを作成。

---

## 2. 売買条件

### 1. 売買トリガー
- 業種ごとの**当日日中リターン**（前処理済みデータ）を、機械学習で予測。
  - **上位3業種**を信用買い。
  - **下位3業種**を信用売り。
- **注文タイミング**: 寄付（寄成注文）。
- **決済方法**: 当日の引成で全て決済。
- **業種数の選定理由**:  
  - 上下1業種だとリターンは大きいが、リスク分散のために3業種とする。

### 2. リスク管理
- **利確・損切り条件**: なし（当日引けで必ず決済するため）。
- **最大ポジションサイズ**: 証券会社の定める上限単位数および空売り規制ルールに従う。
  - 独自の基準は特に設けていない。
- **マーケットトレンドのリスク回避**:  
  - 買いポジションと売りポジションの発注金額をほぼ同額に調整。これにより、マーケット全体のトレンド（上昇/下落）の影響を受けにくくし、リスクを低減している。
- **具体的なリスク管理の対応**:  
  - **最大保有単元数の管理**:  
    - 証券会社が規定する最大保有単元数を超えないように発注することで、リスクを管理。
  - **空売り規制への対応**:  
    - **51単元以上の信用新規売り**は、**前日終値の90.5%程度の低い値段での指値注文**として発注することで、空売り規制を回避。

### 3. トレード頻度・期間
- **頻度**: 年間約250回のトレード（毎営業日）。
  - トレード回数が多いため、**期待値に近い結果を得やすい**設計。
- **保持期間**: 当日中（寄り付きでポジションを取り、引けで決済）。
  - 短期スパンの方が情報の劣化を防ぎ、機械学習による予測精度を保ちやすい。
  - **取引コストの優位性**:  
    - 寄引戦略では**手数料・信用料がゼロ**となるため、コスト面で有利。

## 3. データ前処理

### 1. データの種類
...(外部データや独自データの採用理由)...

### 2. 特徴量の設計
- **外部データ**: 各種データの1日リターン。
- **業種別インデックス**: モメンタム（移動平均）とボラティリティ（標準偏差）を5日・21日スパンで算出。
- **業種情報**: カテゴリ変数として利用。
- **前段モデルの予測結果**: LASSOの生の予測値をLightGBMで使用。

### 3. 目的変数
- **定義**: 業種別インデックスの日中リターン（PCAでマーケットファクターを除去）。
- **計算方法**: 当日終値 / 当日始値 - 1。
- **PCAによるマーケットファクター除去の理由**:  
  - 主成分分析では、分散が最も大きい軸を第一主成分とする。
  - 株式市場では、最も大きなファクターがマーケットリターンであるため、第一主成分を除去することで業種固有の値動きを抽出。

---

## 4. 機械学習モデル

### 1. LASSO
1. **モデル概要**  
   - **特徴量を削減**しオーバーフィッティングを防止。
   - **重要な特徴量に絞り込み解釈性を向上**。
   - **業種ごとのモデリング理由**:  
     - 業種ごとに異なるファクターの影響を受けるため、それぞれに適した特徴量を採用。
   - 使用ライブラリ: **scikit-learn**
   - **業種別に独立した48モデル**を構築。
2. **入力データ**  
   - 外部データの1日リターンのみを採用。
3. **出力データ**  
   - 各業種の日中リターンを予測。
   - **順位をLightGBMアンサンブルに使用**。

---

### 2. LightGBM
1. **モデル概要**  
   - LASSOで捉えきれない非線形な関係を補完。
   - 使用ライブラリ: **lightgbm**
2. **入力データ**  
   - 全特徴量に加え、**LASSOの予測値（生値）**を特徴量として使用。
3. **出力データ**  
   - 全業種の日中リターン予測。  
   - **順位を最終予測に反映**。
4. **評価指標**  
   - Spearman相関係数、Numerai相関係数、シャープレシオなど。
5. **その他**  
   - ツリー深さを浅く設定しツリー数を増やす。

---

### 3. アンサンブル
1. **方法**  
   - LASSOとLightGBMの出力順位を重み付け。
   - **LASSO : LightGBM = 67 : 13**の比率で加重平均。
2. **意図**  
   - 非線形成分を反映し精度を向上。
3. **出力**  
   - **昇順に順位化**し最終予測結果を得る。

## 5. バックテスト結果

### 1. テスト期間
- **学習期間**: 2014年1月1日 ～ 2021年12月31日  
- **テスト期間**: 2022年1月1日 ～ 2024年11月30日  

### 2. 評価指標
- **Spearman順位相関係数**  
- **Numerai相関係数**  
- **リターン・リスク指標**  
  - **最大ドローダウン**: 資産のピークから谷への最大減少率。

### 3. 主要な結果（テスト期間中の評価指標）

#### 日次ベース
- **日平均モデルリターン**: 0.1308%  
- **日平均実運用リターン**: 0.4055%  
- **日平均リターンの標準偏差**: 0.5283%  
- **日平均実運用リターンの標準偏差**: 1.6377%  
- **日次シャープレシオ**: 0.247649  

#### 年間換算
- **年間モデルリターン**: 約32.7%（0.1308% × 250日）  
- **年間実運用リターン（税引前）**: 約101.4%（0.4055% × 250日）  
- **年間リターンの標準偏差**: 約8.36%（0.5283% × √250）  
- **年間実運用リターンの標準偏差**: 約25.91%（1.6377% × √250）  
- **年間シャープレシオ**: 約3.91  

#### その他の指標
- **最大モデルドローダウン実績**: 3.746%  
- **最大実運用ドローダウン実績**: 11.613%  
- **最大ドローダウン日数実績**: 51日  
- **Spearman相関平均**: 0.04404  
- **Numerai相関平均**: 0.05029
